BMARK = sps

TARGET_REDO_BASE      = $(BMARK)-redo-base
TARGET_UNDO_BASE      = $(BMARK)-undo-base
TARGET_REDO_CLWB_BASE = $(BMARK)-redo-clwb-base
TARGET_UNDO_CLWB_BASE = $(BMARK)-undo-clwb-base
TARGET_REDO_WAL       = $(BMARK)-redo-wal
TARGET_UNDO_WAL       = $(BMARK)-undo-wal
TARGET_REDO_FWB       = $(BMARK)-redo-fwb
TARGET_UNDO_FWB       = $(BMARK)-undo-fwb

TARGET = $(TARGET_REDO_BASE) $(TARGET_UNDO_BASE) $(TARGET_REDO_CLWB_BASE) $(TARGET_UNDO_CLWB_BASE) $(TARGET_REDO_WAL) $(TARGET_UNDO_WAL) $(TARGET_REDO_FWB) $(TARGET_UNDO_FWB)              

OBJS_REDO_BASE      = $(TARGET_REDO_BASE).o
OBJS_UNDO_BASE      = $(TARGET_UNDO_BASE).o
OBJS_REDO_CLWB_BASE = $(TARGET_REDO_CLWB_BASE).o
OBJS_UNDO_CLWB_BASE = $(TARGET_UNDO_CLWB_BASE).o
OBJS_REDO_WAL       = $(TARGET_REDO_WAL).o
OBJS_UNDO_WAL       = $(TARGET_UNDO_WAL).o
OBJS_REDO_FWB       = $(TARGET_REDO_FWB).o
OBJS_UNDO_FWB       = $(TARGET_UNDO_FWB).o

OBJS = $(OBJS_REDO_BASE) $(OBJS_UNDO_BASE) $(OBJS_REDO_CLWB_BASE) $(OBJS_UNDO_CLWB_BASE) $(OBJS_REDO_WAL) $(OBJS_UNDO_WAL) $(OBJS_REDO_FWB) $(OBJS_UNDO_FWB)              
#CFLAGS = -O0 -g -ggdb -w  -Wall
CFLAGS = -O3 -w -g -fno-builtin -std=c++11
#LDFLAGS = -lpthread 
LDFLAGS = /home/mogleari/research/pin-2.11/source/tools/Pthread/libmypthread.a
WRAPPER_OBJ = /home/mogleari/research/pin-2.11/source/tools/Apps/mcsim_wrapper.o
CC = g++ 

all: $(TARGET) 

.SUFFIXES:
.SUFFIXES:	.o .c .C .h .H

$(WRAPPER_OBJ): %.o: %.c
	gcc -O0 -g -c $< -o $@

$(OBJS_REDO_BASE):      DFLAGS = -DBASELINE -DREDO 
$(OBJS_UNDO_BASE):      DFLAGS = -DBASELINE -DUNDO
$(OBJS_REDO_CLWB_BASE): DFLAGS = -DBASELINE -DREDO -DCLWB
$(OBJS_UNDO_CLWB_BASE): DFLAGS = -DBASELINE -DUNDO -DCLWB
$(OBJS_REDO_WAL):       DFLAGS = -DREDO -DCLWB
$(OBJS_UNDO_WAL):       DFLAGS = -DUNDO -DCLWB
$(OBJS_REDO_FWB):       DFLAGS = -DREDO 
$(OBJS_UNDO_FWB):       DFLAGS = -DUNDO 

$(OBJS): %.o: $(BMARK).cc
	$(CC) -c $(CFLAGS) $(DFLAGS) -c $< -o $@

$(TARGET_REDO_BASE):      DFLAGS = -DBASELINE -DREDO 
$(TARGET_UNDO_BASE):      DFLAGS = -DBASELINE -DUNDO
$(TARGET_REDO_CLWB_BASE): DFLAGS = -DBASELINE -DREDO -DCLWB
$(TARGET_UNDO_CLWB_BASE): DFLAGS = -DBASELINE -DUNDO -DCLWB
$(TARGET_REDO_WAL):       DFLAGS = -DREDO -DCLWB
$(TARGET_UNDO_WAL):       DFLAGS = -DUNDO -DCLWB
$(TARGET_REDO_FWB):       DFLAGS = -DREDO 
$(TARGET_UNDO_FWB):       DFLAGS = -DUNDO 

$(TARGET_REDO_BASE):      OBJ = $(OBJS_REDO_BASE)    
$(TARGET_UNDO_BASE):      OBJ = $(OBJS_UNDO_BASE)    
$(TARGET_REDO_CLWB_BASE): OBJ = $(OBJS_REDO_CLWB_BASE)
$(TARGET_UNDO_CLWB_BASE): OBJ = $(OBJS_UNDO_CLWB_BASE)
$(TARGET_REDO_WAL):       OBJ = $(OBJS_REDO_WAL)     
$(TARGET_UNDO_WAL):       OBJ = $(OBJS_UNDO_WAL)     
$(TARGET_REDO_FWB):       OBJ = $(OBJS_REDO_FWB)     
$(TARGET_UNDO_FWB):       OBJ = $(OBJS_UNDO_FWB)     

$(TARGET): $(OBJS) $(WRAPPER_OBJ)
	$(CC) -static $(OBJ) $(WRAPPER_OBJ) $(CFLAGS) $(DFLAGS) $(LDFLAGS) -o $@

clean:
	rm -f *.o $(TARGET) $(OBJS) pin*.log
